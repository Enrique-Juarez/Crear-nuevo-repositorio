{"version":3,"file":"index.js","mappings":";;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACiD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,4CAAM;AACjC,YAAY,QAAQ;AACpB;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACO;AACP;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACO;AACP,qBAAqB,mDAAa;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,8CAAoB;AACzC;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,IAAI,4CAAM;AACV,IAAI,4CAAM;AACV,IAAI,4CAAM;AACV;AACA;AACA;AACA;AACO;AACP;AACA;;;;;;;;;;;ACnFA,qC;;;;;;;;;;ACAA,+B;;;;;;;;;;ACAA,iC;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA,E;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA,E;;;;;WCPA,wF;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D,E;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACuD;AAC1B;AACJ;AACsF;AAC/G;AACA;AACA;AACA;AACA;AACA,WAAW,sCAAS,CAAC,yCAAG;AACxB;AACA;AACA;AACA;AACA,aAAa,0CAAa;AAC1B;AACA,+BAA+B,4CAAe;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,yCAAY,CAAC,yCAAY,UAAU,iBAAiB;AAC5D,QAAQ,6CAAgB,wBAAwB,oEAAoE;AACpH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,yCAAY,CAAC,yCAAY,UAAU,iBAAiB;AAC5D,QAAQ,6CAAgB,wBAAwB,8EAA8E;AAC9H;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,yCAAG;AACf;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA,yBAAyB,yCAAG;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,mDAAa;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,sCAAS;AAC9B;AACA;AACA;AACA,KAAK;AACL,qBAAqB,sCAAS;AAC9B;AACA,sCAAsC,sBAAsB;AAC5D;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C,+BAA+B;AAC/B;AACA;AACA;AACA,oBAAoB;AACpB,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,iEAAgB;AACjC,qBAAqB,sCAAS;AAC9B;AACA,IAAI,yEAAwB;AAC5B,IAAI,yCAAG,sBAAsB,iEAAgB;AAC7C,IAAI,6CAAO,+BAA+B,iEAAgB;AAC1D;AACA,IAAI,6CAAO;AACX;AACA,KAAK;AACL,IAAI,6CAAO;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,8DAAa;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,IAAI,6CAAO,gDAAgD,oBAAoB,2BAA2B;AAC1G,IAAI,6CAAO;AACX;AACA,IAAI,6CAAO;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA,yCAAG;AACH,yCAAG;AACH;AACA,QAAQ,yCAAG;AACX,CAAC;AACD,yCAAG;AACH,SAAS,8DAAa;AACtB;AACA,CAAC","sources":["webpack://contador-jubilacion/./main/window-manager.ts","webpack://contador-jubilacion/external node-commonjs \"electron\"","webpack://contador-jubilacion/external node-commonjs \"fs\"","webpack://contador-jubilacion/external node-commonjs \"path\"","webpack://contador-jubilacion/webpack/bootstrap","webpack://contador-jubilacion/webpack/runtime/compat get default export","webpack://contador-jubilacion/webpack/runtime/define property getters","webpack://contador-jubilacion/webpack/runtime/hasOwnProperty shorthand","webpack://contador-jubilacion/webpack/runtime/make namespace object","webpack://contador-jubilacion/./main/index.ts"],"sourcesContent":["/**\n * window-manager.ts\n * Responsable de crear y posicionar la ventana principal y de reaccionar a cambios\n * en la configuración de pantallas (resolución, monitores conectados, etc.).\n */\nimport { BrowserWindow, screen } from 'electron';\n// Margen respecto a los bordes de la pantalla\nconst H_MARGIN = 20;\nconst V_MARGIN = 20;\n// Tamaño base de la ventana (aumentado para reservar espacio a icono configuración)\nconst WINDOW_WIDTH = 320;\nconst WINDOW_HEIGHT = 100;\nlet mainWindow = null;\n/**\n * Calcula la posición en la esquina superior derecha de la pantalla principal.\n */\nfunction getTopRightPosition() {\n    const primaryDisplay = screen.getPrimaryDisplay();\n    const { width } = primaryDisplay.workAreaSize;\n    const x = width - WINDOW_WIDTH - H_MARGIN;\n    const y = V_MARGIN;\n    return { x, y };\n}\n/**\n * Reposiciona la ventana si existe.\n */\nexport function repositionWindow() {\n    if (!mainWindow)\n        return;\n    const { x, y } = getTopRightPosition();\n    mainWindow.setPosition(x, y);\n}\n/**\n * Crea la ventana principal con las propiedades deseadas.\n * No se fija alwaysOnTop para permitir que otras apps la cubran.\n */\nexport function createMainWindow() {\n    mainWindow = new BrowserWindow({\n        width: WINDOW_WIDTH,\n        height: WINDOW_HEIGHT,\n        frame: false,\n        transparent: true,\n        skipTaskbar: true,\n        // Hacemos focusable true para que reciba eventos de hover de forma fiable en macOS.\n        // Al usar showInactive no robará foco inicial y el usuario no notará cambio.\n        focusable: true,\n        acceptFirstMouse: true, // Permite que el primer movimiento/clic sobre la ventana sin foco la active para hover inmediato\n        resizable: false,\n        movable: false,\n        hasShadow: false,\n        show: false, // Mostramos manualmente tras posicionar\n        backgroundColor: '#00000000',\n        webPreferences: {\n            nodeIntegration: false,\n            contextIsolation: true,\n            preload: require('path').join(__dirname, 'preload.js')\n        }\n    });\n    // Inicialmente permitimos interacción para que el usuario pueda acceder al icono de ajustes.\n    // Se podrá volver a modo \"fantasma\" mediante las funciones de interacción si se desea.\n    mainWindow.setIgnoreMouseEvents(false);\n    repositionWindow();\n    mainWindow.once('ready-to-show', () => {\n        mainWindow?.showInactive(); // showInactive => no roba foco\n    });\n    // Si la ventana se intenta mover manualmente (no debería), la re-forzamos\n    mainWindow.on('moved', () => repositionWindow());\n    return mainWindow;\n}\n// Eliminado: lógica de interacción avanzada (simplificación solicitada)\n/**\n * Registra listeners de cambios en pantallas para reposicionar automáticamente.\n */\nexport function registerDisplayListeners() {\n    screen.on('display-metrics-changed', () => repositionWindow());\n    screen.on('display-added', () => repositionWindow());\n    screen.on('display-removed', () => repositionWindow());\n}\n/**\n * Expone acceso interno al BrowserWindow (uso limitado).\n */\nexport function getMainWindow() {\n    return mainWindow;\n}\n","module.exports = require(\"electron\");","module.exports = require(\"fs\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Proceso principal de Electron - Punto de entrada\n * Tarea 2: Refactor para usar window-manager y preload seguros\n */\nimport { app, BrowserWindow, ipcMain } from 'electron';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { createMainWindow, registerDisplayListeners, repositionWindow, getMainWindow } from './window-manager';\n// Archivo de configuración persistente (simple JSON). En evolución futura podría migrarse a algo más robusto.\nconst CONFIG_FILENAME = 'retirement-config.json';\nlet retirementDate = null;\nlet autoLaunchEnabled = false;\nfunction getConfigFilePath() {\n    return path.join(app.getPath('userData'), CONFIG_FILENAME);\n}\nfunction loadRetirementDate() {\n    try {\n        const file = getConfigFilePath();\n        if (!fs.existsSync(file))\n            return;\n        const raw = JSON.parse(fs.readFileSync(file, 'utf-8'));\n        if (raw && typeof raw.retirementTimestamp === 'number') {\n            const dt = new Date(raw.retirementTimestamp);\n            if (!isNaN(dt.getTime())) {\n                retirementDate = dt;\n            }\n        }\n        if (raw && typeof raw.autoLaunch === 'boolean') {\n            autoLaunchEnabled = raw.autoLaunch;\n        }\n    }\n    catch (e) {\n        // eslint-disable-next-line no-console\n        console.warn('[config] Error leyendo configuración:', e);\n    }\n}\nfunction saveRetirementDate(date) {\n    try {\n        const file = getConfigFilePath();\n        fs.mkdirSync(path.dirname(file), { recursive: true });\n        fs.writeFileSync(file, JSON.stringify({ retirementTimestamp: date.getTime(), autoLaunch: autoLaunchEnabled }, null, 2), 'utf-8');\n        retirementDate = date;\n    }\n    catch (e) {\n        // eslint-disable-next-line no-console\n        console.warn('[config] Error guardando configuración:', e);\n    }\n}\nfunction persistConfig() {\n    if (!retirementDate)\n        return;\n    try {\n        const file = getConfigFilePath();\n        fs.mkdirSync(path.dirname(file), { recursive: true });\n        fs.writeFileSync(file, JSON.stringify({ retirementTimestamp: retirementDate.getTime(), autoLaunch: autoLaunchEnabled }, null, 2), 'utf-8');\n    }\n    catch (e) {\n        // eslint-disable-next-line no-console\n        console.warn('[config] Error persistiendo configuración:', e);\n    }\n}\nfunction enableAutoLaunch() {\n    if (process.platform === 'darwin' || process.platform === 'win32') {\n        try {\n            app.setLoginItemSettings({\n                openAtLogin: true,\n                openAsHidden: true, // arranca sin traer foco\n                args: []\n            });\n            autoLaunchEnabled = true;\n            persistConfig();\n        }\n        catch (e) {\n            // eslint-disable-next-line no-console\n            console.warn('[autostart] No se pudo configurar auto inicio:', e);\n        }\n    }\n    else {\n        // Para Linux podríamos incorporar un mecanismo (archivo .desktop) en el futuro.\n    }\n}\nfunction ensureAutoLaunchOnBoot() {\n    if (!autoLaunchEnabled)\n        return; // Solo si ya fue habilitado\n    if (process.platform === 'darwin' || process.platform === 'win32') {\n        const settings = app.getLoginItemSettings();\n        if (!settings.openAtLogin) {\n            enableAutoLaunch();\n        }\n    }\n}\nlet configWindow = null;\nfunction createConfigWindow() {\n    configWindow = new BrowserWindow({\n        width: 400,\n        height: 360,\n        resizable: false,\n        minimizable: false,\n        maximizable: false,\n        title: 'Configurar Jubilación',\n        webPreferences: {\n            preload: path.join(__dirname, 'preload.js'),\n            nodeIntegration: false,\n            contextIsolation: true\n        }\n    });\n    const htmlPath = path.join(__dirname, '../renderer/config.html');\n    configWindow.loadFile(htmlPath);\n    configWindow.on('closed', () => { configWindow = null; });\n    // Auto-ajustar la altura al contenido (limitado para no desbordar pantalla pequeña)\n    configWindow.webContents.on('did-finish-load', () => {\n        configWindow?.webContents.executeJavaScript('Math.max(document.body.scrollHeight, document.documentElement.scrollHeight)').then((h) => {\n            if (!configWindow || configWindow.isDestroyed())\n                return;\n            const max = Math.min(h + 16, 520); // margen extra y límite superior\n            const width = 400; // mantener base\n            try {\n                configWindow.setContentSize(width, max);\n            }\n            catch { /* noop */ }\n        });\n    });\n    return configWindow;\n}\nlet mainWindow = null;\nfunction boot() {\n    loadRetirementDate();\n    // Si no hay fecha configurada, abrimos ventana de configuración primera vez\n    if (!retirementDate) {\n        createConfigWindow();\n    }\n    // Reafirmar autostart si ya estaba configurado previamente\n    ensureAutoLaunchOnBoot();\n    mainWindow = createMainWindow();\n    const htmlPath = path.join(__dirname, '../renderer/index.html');\n    mainWindow.loadFile(htmlPath);\n    registerDisplayListeners();\n    app.on('activate', () => repositionWindow());\n    ipcMain.on('window:reposition', () => repositionWindow());\n    // IPC para obtener y establecer fecha\n    ipcMain.handle('retirement:get', () => {\n        return retirementDate ? retirementDate.getTime() : null;\n    });\n    ipcMain.handle('retirement:set', (_evt, ms) => {\n        const dt = new Date(ms);\n        if (!isNaN(dt.getTime())) {\n            const wasFirstTime = !retirementDate;\n            saveRetirementDate(dt);\n            if (configWindow) {\n                configWindow.close();\n            }\n            // Notificar al renderer principal que la fecha ha cambiado\n            const win = getMainWindow();\n            if (win && !win.isDestroyed()) {\n                win.webContents.send('retirement:updated', dt.getTime());\n            }\n            // Habilitamos auto inicio automáticamente la primera vez que el usuario define la fecha\n            if (wasFirstTime) {\n                enableAutoLaunch();\n            }\n        }\n        return retirementDate ? retirementDate.getTime() : null;\n    });\n    ipcMain.handle('retirement:autoLaunch:enable', () => { enableAutoLaunch(); return autoLaunchEnabled; });\n    ipcMain.handle('retirement:autoLaunch:status', () => autoLaunchEnabled);\n    // Reabrir ventana de configuración bajo demanda\n    ipcMain.handle('retirement:open-config', () => {\n        if (!configWindow) {\n            createConfigWindow();\n        }\n        else {\n            configWindow.focus();\n        }\n        return true;\n    });\n    // Eliminado: interacción avanzada (simplificación solicitada)\n    mainWindow.on('closed', () => {\n        mainWindow = null;\n    });\n}\napp.whenReady().then(boot);\napp.on('window-all-closed', () => {\n    if (process.platform !== 'darwin')\n        app.quit();\n});\napp.on('activate', () => {\n    if (!getMainWindow())\n        boot();\n});\n"],"names":[],"sourceRoot":""}